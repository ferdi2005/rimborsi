<%= form_with(model: paypal_account, class: "row g-3") do |form| %>
  <% if paypal_account.errors.any? %>
    <div class="col-12">
      <div class="alert alert-danger">
        <h6><%= pluralize(paypal_account.errors.count, "errore", "errori") %> ha impedito il salvataggio:</h6>
        <ul class="mb-0">
          <% paypal_account.errors.each do |error| %>
            <li><%= error.full_message %></li>
          <% end %>
        </ul>
      </div>
    </div>
  <% end %>

  <div class="col-md-8">
    <%= form.label :email, "Email PayPal", class: "form-label" %>
    <%= form.email_field :email, class: "form-control", required: true %>
    <small class="form-text text-muted">Indirizzo email associato al tuo account PayPal</small>
  </div>

  <% if current_user.admin? %>
    <div class="col-md-4">
      <%= form.label :user_id, "Utente", class: "form-label" %>
      <%= form.collection_select :user_id, User.all, :id, 
                                ->(user) { "#{user.name} #{user.surname} (#{user.email})" }, 
                                { prompt: "Seleziona utente" }, 
                                { class: "form-select", required: true } %>
    </div>
  <% else %>
    <%= form.hidden_field :user_id, value: current_user.id %>
  <% end %>

  <div class="col-12">
    <div class="form-check">
      <%= form.check_box :default, class: "form-check-input" %>
      <%= form.label :default, "Account PayPal predefinito", class: "form-check-label" %>
    </div>
    <small class="form-text text-muted">Se selezionato, questo diventerà il tuo unico account predefinito (rimuoverà il flag da tutti gli altri account PayPal e conti bancari)</small>
  </div>

  <div class="col-12">
    <%= form.submit "Salva", class: 'btn btn-primary' %>
    <%= link_to 'Annulla', paypal_accounts_path, class: 'btn btn-secondary' %>
  </div>
<% end %>
