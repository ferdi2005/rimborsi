<div class="container-fluid">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1><i class="fas fa-file-invoice-dollar me-2"></i>Rimborsi</h1>
    <%= link_to new_reimboursement_path, class: "btn btn-primary" do %>
      <i class="fas fa-plus me-2"></i>Nuovo Rimborso
    <% end %>
  </div>

  <div class="row">
    <% @reimboursements.each do |reimboursement| %>
      <div class="col-md-6 col-lg-4 mb-4">
        <div class="card h-100">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h6 class="mb-0">Rimborso #<%= reimboursement.id %></h6>
            <% 
              status_config = case reimboursement.status
                             when 'created' then { class: 'secondary', icon: 'fas fa-edit' }
                             when 'in_process' then { class: 'warning', icon: 'fas fa-clock' }
                             when 'approved' then { class: 'success', icon: 'fas fa-check' }
                             when 'paid' then { class: 'primary', icon: 'fas fa-money-bill-wave' }
                             when 'waiting' then { class: 'info', icon: 'fas fa-hourglass-half' }
                             else { class: 'secondary', icon: 'fas fa-question' }
                             end
            %>
            <span class="badge bg-<%= status_config[:class] %>">
              <i class="<%= status_config[:icon] %> me-1"></i><%= reimboursement.status_in_italian %>
            </span>
          </div>
          <div class="card-body">
            <% if current_user.admin? %>
              <p class="card-text"><strong>Utente:</strong> <%= reimboursement.user&.name %> <%= reimboursement.user&.surname %></p>
            <% end %>
            
            <p class="card-text">
              <strong><i class="fas fa-credit-card me-2"></i>Metodo di pagamento:</strong><br>
              <span class="text-muted">
                <% if reimboursement.bank_account.present? %>
                  <i class="fas fa-university me-1"></i><%= reimboursement.payment_method_type %>
                <% elsif reimboursement.paypal_account.present? %>
                  <i class="fab fa-paypal me-1"></i><%= reimboursement.payment_method_type %>
                <% else %>
                  <i class="fas fa-question-circle me-1"></i><%= reimboursement.payment_method_type %>
                <% end %>
              </span><br>
              <% if reimboursement.bank_account.present? %>
                <small><i class="fas fa-credit-card me-1"></i><%= reimboursement.bank_account.iban %> - <%= reimboursement.bank_account.owner %></small>
              <% elsif reimboursement.paypal_account.present? %>
                <small><i class="fas fa-envelope me-1"></i><%= reimboursement.paypal_account.email %></small>
              <% end %>
            </p>
            
            <p class="card-text">
              <strong><i class="fas fa-euro-sign me-2"></i>Totale:</strong> 
              <span class="h5 text-primary">â‚¬ <%= number_with_precision(reimboursement.total_amount, precision: 2) %></span>
            </p>
            
            <p class="card-text">
              <strong><i class="fas fa-receipt me-2"></i>Spese:</strong> <%= pluralize(reimboursement.expenses.count, 'spesa', 'spese') %>
            </p>
            
            <p class="card-text">
              <small class="text-muted">Creato il <%= reimboursement.created_at.strftime("%d/%m/%Y alle %H:%M") %></small>
            </p>
          </div>
          <div class="card-footer">
            <div class="btn-group w-100" role="group">
              <%= link_to 'Visualizza', reimboursement, class: "btn btn-outline-primary btn-sm" %>
              <%= link_to download_pdf_reimboursement_path(reimboursement), class: "btn btn-outline-danger btn-sm" do %>
                <i class="fas fa-file-pdf"></i>
              <% end %>
              <% if reimboursement.user_id == current_user.id || current_user.admin? %>
                <%= link_to 'Modifica', edit_reimboursement_path(reimboursement), class: "btn btn-outline-secondary btn-sm" %>
                <%= link_to 'Elimina', reimboursement, method: :delete, 
                            data: { confirm: 'Sei sicuro di voler eliminare questo rimborso?' }, 
                            class: "btn btn-outline-danger btn-sm" %>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>
  
  <% if @reimboursements.empty? %>
    <div class="alert alert-info text-center">
      <h5>Nessun rimborso trovato</h5>
      <p>Puoi creare il tuo primo rimborso.</p>
      <%= link_to 'Crea Nuovo Rimborso', new_reimboursement_path, class: "btn btn-primary" %>
    </div>
  <% end %>
</div>
