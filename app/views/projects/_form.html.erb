<div class="card shadow-sm">
  <div class="card-header">
    <h5 class="mb-0">
      <i class="fas fa-project-diagram me-2"></i>
      <%= project.persisted? ? "Modifica Progetto" : "Nuovo Progetto" %>
    </h5>
  </div>
  <div class="card-body">
    <%= form_with(model: project, local: true, class: "needs-validation", novalidate: true) do |form| %>
      <% if project.errors.any? %>
        <div class="alert alert-danger" role="alert">
          <h6><i class="fas fa-exclamation-triangle me-1"></i>Errori di validazione:</h6>
          <ul class="mb-0">
            <% project.errors.each do |error| %>
              <li><%= error.full_message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <div class="row">
        <div class="col-md-6">
          <div class="mb-3">
            <%= form.label :name, "Nome del Progetto", class: "form-label" %>
            <%= form.text_field :name, 
                class: "form-control #{'is-invalid' if project.errors[:name].any?}",
                placeholder: "Inserisci il nome del progetto",
                required: true %>
            <% if project.errors[:name].any? %>
              <div class="invalid-feedback">
                <%= project.errors[:name].first %>
              </div>
            <% end %>
          </div>
        </div>
        
        <div class="col-md-6">
          <div class="mb-3">
            <%= form.label :budget, "Budget (€)", class: "form-label" %>
            <div class="input-group">
              <span class="input-group-text">€</span>
              <%= form.number_field :budget, 
                  class: "form-control #{'is-invalid' if project.errors[:budget].any?}",
                  placeholder: "0.00",
                  step: 0.01,
                  min: 0,
                  required: true %>
              <% if project.errors[:budget].any? %>
                <div class="invalid-feedback">
                  <%= project.errors[:budget].first %>
                </div>
              <% end %>
            </div>
            <small class="form-text text-muted">Budget massimo per questo progetto</small>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="mb-3">
            <div class="form-check form-switch">
              <%= form.check_box :active, 
                  class: "form-check-input",
                  id: "project_active" %>
              <%= form.label :active, "Progetto Attivo", 
                  class: "form-check-label",
                  for: "project_active" %>
            </div>
            <small class="form-text text-muted">Solo i progetti attivi possono essere selezionati nelle spese</small>
          </div>
        </div>
      </div>

      <% if project.persisted? %>
        <div class="row">
          <div class="col-12">
            <div class="alert alert-info">
              <h6><i class="fas fa-info-circle me-1"></i>Statistiche Progetto</h6>
              <div class="row">
                <div class="col-md-3">
                  <strong>Spese Totali:</strong><br>
                  <span class="text-primary">€ <%= number_with_precision(project.total_expenses, precision: 2) %></span>
                </div>
                <div class="col-md-3">
                  <strong>Budget Rimanente:</strong><br>
                  <span class="<%= project.remaining_budget < 0 ? 'text-danger' : 'text-success' %>">
                    € <%= number_with_precision(project.remaining_budget, precision: 2) %>
                  </span>
                </div>
                <div class="col-md-3">
                  <strong>% Utilizzato:</strong><br>
                  <span class="<%= project.over_budget? ? 'text-danger' : 'text-primary' %>">
                    <%= project.budget_percentage_used %>%
                  </span>
                </div>
                <div class="col-md-3">
                  <strong>Nr. Spese:</strong><br>
                  <span class="text-info"><%= project.expenses.count %></span>
                </div>
              </div>
            </div>
          </div>
        </div>
      <% end %>

      <div class="d-flex justify-content-between">
        <%= link_to projects_path, class: "btn btn-secondary" do %>
          <i class="fas fa-arrow-left me-1"></i>Torna ai Fondi
        <% end %>
        
        <div>
          <% if project.persisted? %>
            <%= link_to project, class: "btn btn-outline-primary me-2" do %>
              <i class="fas fa-eye me-1"></i>Visualizza
            <% end %>
          <% end %>
          <%= form.submit class: "btn btn-primary" do %>
            <i class="fas fa-save me-1"></i><%= project.persisted? ? "Aggiorna Progetto" : "Crea Progetto" %>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</div>
