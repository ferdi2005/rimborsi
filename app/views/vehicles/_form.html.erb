<%= form_with(model: vehicle, class: "row g-3") do |form| %>
  <% if vehicle.errors.any? %>
    <div class="col-12">
      <div class="alert alert-danger">
        <h6><%= pluralize(vehicle.errors.count, "errore", "errori") %> ha impedito il salvataggio:</h6>
        <ul class="mb-0">
          <% vehicle.errors.each do |error| %>
            <li><%= error.full_message %></li>
          <% end %>
        </ul>
      </div>
    </div>
  <% end %>

  <% if current_user.admin? %>
    <div class="col-md-6">
      <%= form.label :user_id, "Utente", class: "form-label" %>
      <%= form.collection_select :user_id, User.all, :id, 
                                ->(user) { "#{user.name} #{user.surname} (#{user.email})" }, 
                                { prompt: "Seleziona utente" }, 
                                { class: "form-select", required: true } %>
    </div>
  <% else %>
    <%= form.hidden_field :user_id, value: current_user.id %>
  <% end %>

  <div class="col-md-6">
    <%= form.label :name, "Nome del veicolo", class: "form-label" %>
    <%= form.text_field :name, class: "form-control", required: true, placeholder: "es. Auto mia, Moto..." %>
    <small class="form-text text-muted">Nome personalizzato per identificare il veicolo</small>
  </div>

  <div class="col-md-4">
    <%= form.label :vehicle_category, "Categoria", class: "form-label" %>
    <%= form.select :vehicle_category, 
                    options_for_select([
                      ['Autovettura', 'autovettura'],
                      ['Fuoristrada/SUV', 'fuoristrada_suv'],
                      ['Motociclo', 'motociclo'],
                      ['Ciclomotore', 'ciclomotore'],
                      ['Autofurgone', 'autofurgone'],
                      ['Autocaravan', 'autocaravan']
                    ], vehicle.vehicle_category), 
                    { prompt: "Seleziona categoria" }, 
                    { class: "form-select", required: true } %>
  </div>

  <div class="col-md-4">
    <%= form.label :brand, "Marca", class: "form-label" %>
    <%= form.text_field :brand, class: "form-control", required: true, placeholder: "es. Fiat, BMW, Honda..." %>
  </div>

  <div class="col-md-4">
    <%= form.label :model, "Modello", class: "form-label" %>
    <%= form.text_field :model, class: "form-control", required: true, placeholder: "es. Punto, X3, Civic..." %>
  </div>

  <div class="col-md-8">
    <%= form.label :fuel_type, "Tipo di carburante", class: "form-label" %>
    <%= form.select :fuel_type, 
                    options_for_select([
                      ['Altro', 'altro'],
                      ['Benzina e gas liquido', 'benzina_e_gas_liquido'],
                      ['Benzina e metano', 'benzina_e_metano'],
                      ['Benzina verde', 'benzina_verde'],
                      ['Elettrica', 'elettrica'],
                      ['Gasolio', 'gasolio'],
                      ['Ibrido-benzina', 'ibrido_benzina'],
                      ['Ibrido-gasolio', 'ibrido_gasolio'],
                      ['Ibrido plugin-benzina', 'ibrido_plugin_benzina'],
                      ['Metano esclusivo', 'metano_esclusivo']
                    ], vehicle.fuel_type), 
                    { prompt: "Seleziona tipo di carburante" }, 
                    { class: "form-select", required: true } %>
  </div>

  <div class="col-12">
    <div class="form-check">
      <%= form.check_box :default, class: "form-check-input" %>
      <%= form.label :default, "Veicolo predefinito", class: "form-check-label" %>
    </div>
    <small class="form-text text-muted">Se selezionato, questo diventer√† il tuo veicolo predefinito per le spese auto</small>
  </div>

  <div class="col-12">
    <%= form.submit "Salva", class: 'btn btn-primary' %>
    <%= link_to 'Annulla', vehicles_path, class: 'btn btn-secondary' %>
  </div>
<% end %>
